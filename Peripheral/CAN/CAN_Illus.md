# NXP S32K系列 (S32DS环境)指南

## 版权

© 2025 . 未经许可不得复制、修改或分发。 此文献为 [小風的藏書閣](https://t.me/xfp2333) 所有。

# CAN总线介绍

---

## 什么是CAN总线

CAN（Controller Area Network）总线是一种多主机串行通信协议，最初由博世（Bosch）公司开发，广泛应用于汽车电子和工业自动化领域。它通过双线差分信号传输数据，能够在噪声环境下保证高可靠性。CAN允许多个控制器（节点）共享同一总线，通过消息优先级仲裁机制，实现实时数据交换。

---

## 通信协议

* **帧结构**：标准CAN帧包含起始位、仲裁段（11位ID）、控制段、数据段（0\~8字节）、CRC校验、应答和帧结束位。
* **仲裁机制**：基于位优先级的非破坏式总线仲裁，优先级高的节点可抢占总线，避免冲突。
* **数据长度**：传统CAN数据字段最大8字节；CAN FD扩展到64字节。
* **错误检测与处理**：支持CRC校验、位监控、确认错误、格式错误等机制，保证数据完整性。

---

## 通信流程

1. **空闲总线监测**：节点监测总线空闲后，准备发送。
2. **发送请求**：节点发送起始位并开始仲裁ID。
3. **总线仲裁**：所有尝试发送的节点比较ID位，ID最低（优先级最高）节点赢得发送权。
4. **数据发送**：获胜节点发送数据帧。
5. **应答阶段**：所有正确接收帧的节点发送应答位，确认数据正确。
6. **结束与释放总线**：发送节点发送帧结束位，释放总线，其他节点准备接收或发送。

---

## 通信时序

* **位定时**：节点内部时钟同步，通过同步段、时间段1、时间段2定义每个位的时间长度。
* **波特率同步**：通过同步段调整采样点，保证所有节点对位边界的一致识别。
* **位间隔与帧间隔**：保证帧与帧之间有最小空闲时间，便于总线仲裁和恢复。

---

## 物理层电平逻辑

* **差分信号**：CAN使用两条线（CAN\_H和CAN\_L）传输差分信号。
* **电平定义**：

  * **显性位（逻辑0）**：CAN\_H线电压约为3.5V，CAN\_L线约为1.5V，二者差分电压约为2V以上。
  * **隐性位（逻辑1）**：CAN\_H和CAN\_L线电压均约为2.5V，二者电压接近，差分电压约为0V。
* **抗干扰能力**：差分信号使得环境噪声对两线同时影响，接收器检测两线电压差，有效抑制干扰。
* **终端电阻**：总线两端各接一个120Ω终端电阻，保证信号完整和阻抗匹配。

---
